# SeriousCompany Site Core

Ядро для быстрой и удобной разработки сайта.  
  
Сайт был разработан на nginx, php7.4, mysql  
Настройки ядра на nginx находятся в файле `nginx-config`  
  
Рекомендуется пересылать все запросы на index.php  
За исключением тех запросов, в которых вызываются файлы шаблона или другие файлы.  
  
Внимание! Для корректной установки сайта необходимо, чтобы сайту была доступна  
для записи корневая директория сайта.  
При установке он создаст некоторые конфигурации в папке `configs`.  
  
Для установки сайта просто закиньте содержимое src в корень сайта и через браузер вызовите index.php.  
Далее вам покажется мастер установки.  
  
В данном репозитории содержится лишь ядро. Документацию модулей, смотрите в репозиториях конкретного модуля.


# Главная цель ядра

Ядро основано на модулях. Каждый модуль отвечает за определенный функционал.  
Возможно, чтобы один модуль использовал функционал другого.  
Вы можете заменить стандартные модули (те, которые предустановлены)  
на свои и подстроить структуру сайта под себя.  
Единственное, что контролируется вне модулей, это вызов страницы.  
Если модуль зависит от другого, то необходимо это указать в соответствующем  
методе в индексе, чтобы сначало подгрузился модуль, от которого зависит текущий.  
Необходимый модуль подгрузится лишь тогда, когда вы явно укажете, что хотите работать с модулем.  
За подгрузку модуля и получение его индекса отвечает метод `/modules/Module::load("MODULE_NAME")`


# Что удобного в модульной системе?

Модуль выполняет свою определенную задачу.  
Модуль можно легко заменить любым другим, без необходимости координально переписывать сайт.  
Модуль подгружается лишь тогда, когда это необходимо и не занимает лишнюю оперативную память  
и время загрузки страницы.  
Также такая система позволяет повысить читабельность кода,  
путем осмысленного разделения функционала на части.

# Создание страницы

В ядре присутствует система управления страницами, в которой вы можете создать новую.  
После установки ядра вам будет показана системная страница по управлению собой и другими страницами.  
При желании вы можете заменить стандартную страницу на любую другую.  
При создании страницы вы должны указать обработчик страницы, который должен быть унаследован от `\PathExecutor`.  
У вас будут методы по получению заголовка страницы, проверки страницы, а также сам метод вызова обработки страницы.  
Также вам будет передана переменна пути и параметров вызова страницы, чтобы вы могли проверить параметры  
и необходимость показа страницы или ее скрытия.  
  
И в нем (`\PathExecutor`) вы уже можете подгрузить необходимые вам  модули, через `\modules\Module::load($module)`  
Этот метод инициализирует модуль единожды, а дальше сохраняет объект индекса модуля в памяти.  
При повторном вызове этого метода с такимже модулем она возвратит сохраненный ранее объект.  
Тоесть можно без опасения лишних действий вызывать функцию несколько раз.  
Метод передаст вам объект индекса модуля. Далее все зависит от функционала модуля.  


# Работа с базой данных

Сайт сам открывает базу данных, с которой вы можете в ручную, при желании.  
Объект mysqli connection будет храниться в глобальной переменной `$GLOBALS["MYSQLI_CONNECTION"]`  
и автоматически закроется, при завершении работы скрипта.  
  
Также для более удобной работы с сохраняемыми объектами предусмотрен класс `\StorableObject`.  
Класс уже содержит все необходимые методы для сохранения и загрузки данных в базу данных.  
  
Существует класс `\Condition` (`StoredObjectCondition.class.php`) упрощающий составление условия запроса на необходимый объект.  
Также существует класс `\Connection` (`StoredObjectConnection.class.php`) для связи объекта с другим объектом типа `\StorableObject`.  
  
Для того, чтобы понять как работать с классом достаточно посмотреть на методы инструмента `StoredObject.class.php`  
Также стоит посмотреть инструмент `path.class.php` Так как `\Path` является наследником `\StoredObject`  
и является явным примерном использования данного класса.

# Система событий

Система событий позволит вам зарегистрировать слушателя на определенное событие на сайте  
и выполнить определенные действия до или после события.  
Например сделать что-либо с объектом до его сохранения в базу данных.  
Класс `\Event` ( Инструмент `Event.class.php` ) отвечает за простую систему событий  
У него всего 3-и статических метода `call`, `regListener`, `unregListener`  
По названиям понятно какой метод чем занимается.  
Работает это следующим образом:  
Регистрируется некий файл, в котором есть класс со статическим методом (слушатель).  
При вызове `call` будут загружены все слушатели указанного события и у всех будут вызваны зарегистрированные методы.  
  
Параметры методов можете узнать, посмотрев исходный код инструмента `Event.class.php`


# Смена изначальной структуры ядра

Изначально ядро знает о 5 директориях, с которыми он работает.  
Все эти пути меняются в `index.php`.  
Обязателен слэш на конце (кроме `root`).  
Все директории, кроме `root` должны указываться относительно корня сайта.
- `root` - Корневая директория сайта
- `instruments` - Директория, хранящая все инструменты и модули
- `configs` - Директория, хранящия настройки сайта
- `cache` - Директория, хранящия кэш сайта
- `content` - Директория, загружаемого (публичного) контента пользователей сайта. Например аватарки или картинки новостей.