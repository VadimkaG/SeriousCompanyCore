# SeriousCompany Site Core

Ядро для быстрой и удобной разработки сайта.

Сайт был разработан на nginx, php7.4
Настройки сайта на nginx находятся в файле `nginx-config`

Рекомендуется пересылать все запросы на index.php
За исключением тех запросов, в которых вызываются файлы шаблона или другие файлы.

Внимание! Для корректной установки сайта необходимо, чтобы сайту была доступна
для записи корневая директория сайта.
При установке он создаст некоторые конфигурации в папке `configs`.

А также модуль templates компилирует свои шаблоны в директорию `templates/compiled`.
Она соответственно тоже должна быть доступна для записи.

Шаблоны html модуль tempaltes будет искать в директории `tempaltes/templates`.
Но она уже не нужна для записи, однако запросы должны доходить до этой директории,
чтобы сайт мог получить css, js или другие файлы шаблонов.

Для установки сайта просто закиньте содержимое src в корень сайта и через браузер вызовите index.php.
Далее вам покажется мастер установки.

По умолчанию данные администратора в модуле admin.

Логин: `admin`.
Пароль: `admin`.


# Главная цель ядра

Ядро основано на модулях. Каждый модуль отвечает за определенный функционал.
Возможно, чтобы один модуль использывал функционал другого.
Вы можете заменить стандартные модули (те, которые предустановлены) 
на свои и подстроить структуру сайта под себя.
Единственное, что контролируется вне модулей, это вызов страницы.
Если модуль зависит от другого, то необходимо это указать в соответствующем 
методе в индексе, чтобы сначало подгрузился модуль, от которого зависит текущий.
Необходимый модуль подгрузится лишь тогда, когда вы явно укажете, что хотите работать с модулем.
За подгрузку модуля и получение его индекса отвечает метод `/modules/Module::load("MODULE_NAME")`


# Что удобного в модульной системе?

Вы разрабатываете модуль всего один раз, а далее используете его в остальных своих проектах.
Для каждого проекта вы вставляете модуль, необходимый для конкретного проекта.
Модуль не подгружается до того, пока вы сами его не вызовите.
Таким образом в момент вызова страницы будет подгружено лишь необходимое.

# Создание страницы

В ядре присутствует система управления страницами, в которой вы можете создать новую.
После установки ядра (чистого) вам будет показана системная страница по управлению собой и другими страницами.
При желании вы можете заменить стандартную страницу как это делает модуль templates.
При создании страницы вы укажете обработчик страницы, который должен быть унаследован от `\PathExecutor`.
У вас будут методы по получению заголовка страницы, проверки страницы, а также сам метод вызова обработки страницы.
Также вам будет передана переменна пути страницы, чтобы вы могли обработать местонахождение страницы.
И в нем вы уже можете подгрузить необходимые вам  модули, через `\modules\Module::load($module)`
Эта функция инициализирует модуль единожды, а дальше сохраняет объект индекса модуля.
При повторном вызове этой функции с такимже модулем она возвратит сохраненный ранее объект.
Тоесть можно без опасения лишних действий вызывать функцию несколько раз.
Функция передаст вам объект индекса модуля. Далее все зависит от функционала модуля.


# Класс базы данных

Вы можете получить объект для работы с базой данных простым вызовом `\database::getInstance()`.
Объект также сохранятся, так что можно без опасок вызывать функцию сколько угодно.


# Локализация

Ядро поддерживает локализацию.
Для этого в конфиге нужно указать массив `locales` с возможными локализациями.
Указывается псевданим, с помощью которого будет вызываться та или иная локализация.
например `/en/about` `/ru/about`. Путь без префикса локализации будет указывать на локализацию по умолчанию.
Она задается также в конфиге строкой `locale_default`.
Сама локализация не обрабатывается ядром.
Когда ядро обнаружило локализацию, она будет указана в константе `LOCALE`
А также будет константа `LOCALE_PREFIX` это префикс локализации к URL.
Для упрощения создания URL на ту или иную страницу.


# Смена изначальной структуры ядра
Изначально ядро знает о 4 директориях, с которыми он работает.
Все эти пути меняются в `index.php`.
Обязателен слэш на конце.
Все директории, кроме `root` должны указываться относительно корня сайта.
- `root` - Корневая директория сайта
- `instruments` - Директория, хранящая все инструменты и модули
- `configs` - Директория, хранящия настройки сайта
- `content` - Директория, загружаемого контента пользователей сайта. Например аватарки или картинки новостей.


# Использывание модуля templates

Для создания страницы на основе модуля шаблонов templates вам нужно 
перед инициализацией класса обработчика подгрузить модуль templates. 
И в инициализации класса наследоваться не от `\PathExecutor`, а от `\modules\template\handler`.
Первым вызовется метод `validate`. Это метод запроса права на запрос страницы.
В нем необходимо вернуть `true`, `false` или `throw \PathNotValidatedException`.
Если `validate` получает `true`, то будет запрошен метод `response`. Этот метод служит, для обработки контента страницы.
Для того, чтобы начать вывод контаента по шаблону, вам необходимо вызвать метод `$this->proc()`. 
Для указания имени шаблона вам необходимо переопределить константу `TEMPLATE`. 
Для подробности смотрите в исходный код класса Handler.

Далее в директории `/templates/templates/` необходимо создать директорию вашего нового шаблона.
Шаблон по умолчанию называется `default`. При желании можно изменить в конфигах. 
В директории шаблона необходимо создать `config.json` со следующим содержимым (JSON):
- `version` - Версия шаблона
- `block_prefix` - Префикс блока (по умолчанию `{% `)
- `block_suffix` - Суффикс блока (по умолчанию ` %}`)
- `block_prefix_closed` - Префикс закрывающего блока (по умолчанию `{%/ `)
- `value_prefix` - Префикс переменной (по умолчанию `{{ `)
- `value_suffix` - Суффикс блока (по умолчанию ` }}`)

Сами html шаблоны будут храниться в директории `templates/templates/YOUR_TEMPLATE_NAME/templates`
В константе Handler указывается лишь название шаблона без `.html`.
Но физически шаблон должен иметь `.html` в конце.
Для указания блока необходимо заключить в открывающее и закрывающее выражение блока.
Например:

```
{% MY_BLOCK_NAME %}Тут содержимое вашего блока, 
Которое не зависит от переносов и т.п. 
А это ваша переменная блока - {{ MY_VARIABLE_NAME }}
{%/ MYBLOCK_NAME %}
```

Все что лежит вне размеченных вами блоков тоже считается блоком.
Он вызывается методом `proc()` в вашем обработчике страницы, когда вы начинаете обработку шаблона.
Этот метод принимает теже параметры, что и отальные блоки.

Блоки могут быть бесконечно вложенными. Каждому имени блока будет соответствовать метод в обработчике.
При выводе они выведутся именно в той вложенности, в которой вы их расположили.
В контейнере блок будет вызывать `callBlock(&$blockClass,$blockName,$container,&$data)` и передавать метод вывода данного блока.
По умолчанию эта функция переводит все вызовы на `Block_$container($blockName,$blockClass,$data)` для удобства.
Однако можно переопределить метод в обработчике и использывать на свое усмотрение.
Для вывода шаблона в `callBlock` необходимо вызвать `$blockClass->$blockName($variables,$data)`
Таким образом можно выводить содержимое блока сколько угодно раз, а можно и не выводить вообще.

Предпологается, что логика страницы будет обрабатываться до вызова метода `proc()`, 
а все последующие вызовы будут выводить контент. Переменная `&$data` служит, 
для передачи данных во вложенные блоки.

Описание переменных метода `callBlock`:
- `&$blockClass` - Класс шаблона, для вызова метода содержимого блока
- `$blockName` - Имя метода для вывода содержимого блока
- `$container` - Имя блока, который вы указывали в шаблоне
- `$data` - Данные, которые передал родитель. (может быть любым типом)

Метод содержимого блока содержит следующие параметры:
- `$variables` - Список переменных. Те самые, которые вы указываете в шаблоне.
- `$data` - Данные, которые будут переданы во вложенные блоки.

При этом переменные действуют только в рамках одного блока и не наследуются от блоков-родителя.
Тоесть если вам нужно допустим передать переменную во вложенный блок, 
то вам необходимо передавать ее в `$data`
