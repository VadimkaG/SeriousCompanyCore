<div id="edit_popup" class="overlay-popup" style="display:none">
	<div class="popup">
		<button class="close" title="Закрыть" onclick="$('#edit_popup').hide();"></button>
		<form method="POST">
			<input type="hidden" name="action" value="edit_news">
			<input type="hidden" name="id">
			Псевдоним (пока не используется):<br>
			<input name="alias" placeholder="Псевдоним" required><br>	
			Название:<br>
			<input name="title" placeholder="Название" required><br>
			<input type="checkbox" name="published"> Опубликовать новость<br>
			Текст новости (HTML):<br>
			<textarea id="editor_edit" name="body" style="max-width: 95%;width:95%;height:200px;"></textarea>
			<br>
			<input type="submit" value="Отредактировать">
		</form>
	</div>
</div>
<div id="remove_popup" class="overlay-popup" style="display:none">
	<div class="popup">
	<button class="close" title="Закрыть" onclick="$('#remove_popup').hide();"></button>
	<h2>Вы действительно хотите удалить новость?</h2>
	<form method="POST">
		<input type="hidden" name="action" value="remove_news">
		<input type="hidden" name="id">
		<input class="btn bc_gray" type="submit" value="Удалить">
		<a class="btn bc_gray" onclick="$('#remove_popup').hide();">Отмена</a>
	</form>
	</div>
</div>
<div id="add_popup" class="overlay-popup" style="display:none">
	<div class="popup">
		<button class="close" title="Закрыть" onclick="$('#add_popup').hide();"></button>
		<form method="POST">
			<input type="hidden" name="action" value="add_news">
			Псевдоним (пока не используется):<br>
			<input name="alias" placeholder="Псевдоним" required><br>
			Название:<br>
			<input name="title" placeholder="Название" required><br>
			<input type="checkbox" name="published" checked> Опубликовать новость<br>
			Текст новости (HTML):<br>
			<textarea id="editor_add" name="body" style="max-width: 95%;width:95%;height:200px;"></textarea>
			<br>
			<input type="submit" value="Добавить">
		</form>
	</div>
</div>
<div class="pages"></div>
<a class="event_add btn bc_gray">Добавить новость</a>
<div class="block">
	<div class="block-head">Новости</div>
	<form method="POST" action="/admin/users/">
		<input type="hidden" name="action" value="changeUsersByAdmin">
		<ul id="table_content" class="block-body"></ul>
	</form>
</div>
<!--SYS_BLOCK%scripts%-->
<script src="/<!--SYS_VAL%scripts%-->/HTMLEditor.js"></script>
<script>
			// Функция обновления контента
	function updateContent() {
			// Подгрузка кнопок страниц
		$.get("",{"count":"true"},function(data){
			var con = "<a class=\'btn\'>1</a>";
			col=1;
			p=0;
			for(i=1;i<=data;i++){
				if(p==20){
					p=0;
					col++;
					con += "<a class=\'btn\'>"+col+"</a>";
				}
				p++;
			}
			$(".pages").html(con);
			$(".pages").find("a").click(function(){window.page = $(this).text();updateContent();});
		});
			
			// Подгрузка основного контента
		$.get("",{"json":"true","page":window.page},function(data){
			var jdata = JSON.parse(data);
			var con = "<li class=\"tline\"><div class=\"tline-cell\">Псевдоним</div><div class=\"tline-cell\">Заголовок</div><div class=\"tline-cell\">Опубликовано</div><div class=\"tline-cell\">Действие</div></li>";
			for (var i in jdata) {
				con += "<li class=\"tline\">\
				<div class=\"tline-cell\">"+jdata[i]["alias"]+"</div>\
				<div class=\"tline-cell\">"+jdata[i]["title"]+"</div>\
				<div class=\"tline-cell\">"+jdata[i]["pub"]+"</div>\
				<div class=\"tline-cell\">\
				<a class=\"btn bc_gray event_delete\" data-id=\""+i+"\">Удалить</a><br>\
				<a \
					class=\'btn bc_gray event_edit\' \
					data-id=\'"+i+"\' \
					data-alias=\'"+jdata[i]["alias"]+"\' \
					data-title=\'"+jdata[i]["title"]+"\'\
					data-body=\'"+jdata[i]["body"]+"\'\
				>Редактировать</a></div>\
				</li>";
			}
			con += "<input type=\"submit\" value=\"Применить\" class=\"btn bc_gray\">";
			con += "		<a class=\"btn bc_gray\" onclick=\"updateContent();\" >Обновить</a>";
			$("#table_content").html(con);
			var editform = $("#edit_popup");
	
			// Обработка эвентов
			$(".event_edit").click(function(){
				$("#title-edit_popup").text($(this).attr("data-name"));
				editform.find("input[name=id]").val($(this).attr("data-id"));
				editform.find("input[name=alias]").val($(this).attr("data-alias"));
				editform.find("input[name=title]").val($(this).attr("data-title"));
				editform.find("textarea[name=body]").text($(this).attr("data-body"));
				editform.show();
			});
			$(".event_delete").click(function(){
				$("#remove_popup").find("input[name=id]").val($(this).attr("data-id"));
				$("#remove_popup").show();
			});
		});
	}
	$(".event_add").click(function(){
		$("#add_popup").show();
	});
		
		// При загрузке страницы
	$(function($){
		window.page = 1;
		updateContent();
		new HTMLEditor(document.getElementById("editor_add"),"Добавить новость",true);
		new HTMLEditor(document.getElementById("editor_edit"),"Редактировать новость",true);
	});
</script>
<!--/SYS_BLOCK%scripts%-->
